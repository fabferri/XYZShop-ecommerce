# XYZShop - Django E-Commerce Project

A Django-based e-commerce website for hardware and tools with 500+ products, where customers can browse and purchase products with full user authentication, order management, and admin panel.
The e-commerce website includes a warehouse management system.

## Table of Contents

- [Project Structure](#project-structure)
- [Installation & Setup](#installation--setup)
- [Database Setup](#database-setup)
- [Running the Project](#running-the-project)
- [Utility Scripts](#utility-scripts)
- [Models](#models)
- [URLs Reference](#urls-reference)

---

## Project Structure

```
test-dijango5/
├── products/          # Product catalog and category management
│   └── static/        # Product-specific static files
├── cart/              # Shopping cart functionality
├── orders/            # Order processing and management
├── accounts/          # User authentication and profile management
├── xyz_store/         # Main project settings and configuration
├── media/             # Uploaded images and files
│   └── products/      # Product images 1024x1024
├── templates/         # HTML templates
└── manage.py          # Django management script
```

---

## Installation & Setup

The project is already set up in your virtual environment with Django 5.2.9 and Python 3.13.

### Prerequisites

- Python 3.13
- pip (Python package installer)
- Virtual environment (.venv)

### Initial Setup

1. Open a terminal and activate the virtual environment:
   ```bash
   .venv\Scripts\Activate.ps1
   ```

1. **Install Dependencies**:
   ```python
   pip install -r requirements.txt
   ```

Note: Review the available library versions to check whether requirements.txt contains any outdated dependencies:

```python
pip index versions asgiref
pip index versions Django
pip index versions pillow
pip index versions sqlparse
pip index versions tzdata
```

## Database Setup

The file **db.sqlite3** is missing from the project than the database must be created as the first step. Django automatically builds the database structure when you run migrations. The project includes utility scripts for database management.

### Creating Database from Scratch

1. Open a terminal and activate the virtual environment:

   ```bash
   .venv\Scripts\Activate.ps1
   ```

1. **Run migrations** to create database structure:

   ```powershell
   python manage.py migrate
   ```

   Migrations is required before creating users.

1. **Create a superuser** for admin access for the first time:
Django does not come with a default admin username or password. To access the Django admin panel, you must create a superuser manually. This ensures security and prevents unauthorized access.

   ```powershell
   python manage.py createsuperuser
   ```

   You will be prompted for:
   - Username
   - Email address
   - Password (hidden while typing, must meet Django’s password validation rules)

1. **Populate the database** with products, users, orders, product review:

   ```python
   python restore_database.py
   ```

   - Deletes all existing products, categories, orders, and sales
   - Imports product definitions from `exported_products.py`
   - Recreates all 507 products from exported data
   - load 408 online products (visible to customers)
   - load 99 products in the warehouse (visible to the admin only). The warehousing products are flagged with `is_online=False`
   - Includes all 9 categories: Electrical, Garden, Hand Tools, Outdoor, Paint & Decorating, Plumbing, Power Tools, Screws & Fixings, Sealants
   - add users and create some orders
   - **Product images**: All stored in `media/products/` folder (1024x1024 .jpg format, generated by DALL-E 3)

---

## If You Forget the Admin Password

Django stores passwords in a hashed format, so you cannot view the old password — you must reset it.

### Method 1 – Using Django Shell:
```
python manage.py shell

from django.contrib.auth.models import User
user = User.objects.get(username='admin') # Replace with your username
user.set_password('NewSecurePassword123!')
user.save()
```
Exit the shell and log in with the new password.

### Method 2 – Using changepassword Command:
```
python manage.py changepassword admin
```
Replace admin with your username, then enter and confirm the new password.

### Method 3 – Create a New Superuser (if username is forgotten):
```
python manage.py createsuperuser
```

---

## Running the Project

1. **Start the development server**:

   In virtual environment  (.venv\Scripts\Activate.ps1)

   ```python
   python manage.py runserver
   ```

1. **Access the site**:
   - **Main Store**: <http://127.0.0.1:8000/>
   - **Admin Panel**: <http://127.0.0.1:8000/admin/>
   - **Shopping Cart**: <http://127.0.0.1:8000/cart/>

---


## Models

### Product
- **Category**: ForeignKey to Category
- **Name**: Product name (max 200 characters)
- **Slug**: URL-friendly identifier (auto-generated)
- **Image**: Product image file
- **Description**: Detailed product description (optional)
- **Price**: Decimal field (10 digits, 2 decimal places)
- **Cost Price**: Purchase cost (optional, for margins)
- **Stock**: Integer for available quantity
- **Available**: Boolean for visibility
- **Is Online**: Boolean for warehouse status
- **Created**: Auto timestamp on creation
- **Updated**: Auto timestamp on modification

### ProductPriceHistory
- **Product**: ForeignKey to Product (related_name='price_history')
- **Cost Price**: Historical cost price at time of change
- **Selling Price**: Historical selling price at time of change
- **Changed By**: ForeignKey to User (optional, who made the change)
- **Changed At**: Timestamp of when the price was changed
- **Reason**: Optional text field for reason of price change
- **Calculated Fields**: Margin percentage and profit

**Features**:
- Automatic tracking via Django signals (no manual intervention needed)
- Complete audit trail of all price changes
- Color-coded margin display in admin (green=high, red=loss)
- Read-only to ensure data integrity
- Indexed for fast queries

### ProductReview
- **Product**: ForeignKey to Product (related_name='reviews')
- **User**: ForeignKey to User (who wrote the review)
- **Rating**: Integer field (1-5 stars)
- **Title**: Review title (max 200 characters)
- **Comment**: Review text content
- **Verified Purchase**: Boolean indicating if user purchased the product
- **Created**: Auto timestamp on creation
- **Updated**: Auto timestamp on modification

**Features**:
- One review per user per product (unique_together constraint)
- Visual star rating display (★★★★★)
- Display on product detail pages with rating summary
- Rating distribution calculation
- Verified purchase badge for authenticated purchases

### Category
- **Name**: Category name (max 200 characters, unique)
- **Slug**: URL-friendly identifier (unique, auto-generated)

### Order
- **User**: ForeignKey to User (optional, nullable for guest orders)
- **First Name**: Customer first name
- **Last Name**: Customer last name
- **Email**: Customer email
- **Address**: Delivery address
- **Postal Code**: Delivery postal code
- **City**: Delivery city
- **Created**: Auto timestamp on creation
- **Updated**: Auto timestamp on modification
- **Paid**: Boolean for payment status

### OrderItem
- **Order**: ForeignKey to Order
- **Product**: ForeignKey to Product
- **Price**: Decimal field (price at time of order)
- **Quantity**: Integer for number of items

---

## URLs Reference

### Customer URLs
- **Home**: `/` or http://127.0.0.1:8000/
- **All Products**: `/products/`
- **Category**: `/products/category/<slug>/`
- **Product Detail**: `/products/<slug>/`
- **Search**: `/products/search/?q=<query>`
- **Cart**: `/cart/`
- **Checkout**: `/orders/create/`
- **Register**: `/accounts/register/`
- **Login**: `/accounts/login/`
- **Logout**: `/accounts/logout/`
- **Profile**: `/accounts/profile/`
- **Order History**: `/accounts/orders/`

### Admin URLs
- **Admin Dashboard**: `/admin/`
- **Products**: `/admin/products/product/`
- **Categories**: `/admin/products/category/`
- **Orders**: `/admin/orders/order/`
- **Order Items**: `/admin/orders/orderitem/`
- **Users**: `/admin/auth/user/`

---

---

## Add manually new products

The folder **add-new-products-manually** contains a list of product pictures and product description to add manually the products after the database has been created and the website is running. Add the products with adminsitrator account.

## Utility Scripts

The project includes utility scripts for database management and maintenance:


### export_products.py

**Purpose**: Exports all current product definitions from database

**Usage**:

```powershell
python export_products.py
```

**What it does**:
- Queries all products and categories from database
- Generates Python code with CATEGORIES and ALL_PRODUCTS dictionaries
- Saves to `exported_products.py` file
- Preserves all product attributes including online/warehouse status

**When to use**:
- Creating backup of current product data
- Before making major changes to database
- Sharing product catalog structure

### db_populate_fresh_database.py

**Purpose**: Populates database with products marked as warehouse (not online)

**Usage**:
```powershell
python db_populate_fresh_database.py
```

**What it does**:
- Deletes all existing products and categories
- Creates 4 sample categories
- Creates products with `is_online=False` (warehouse status)
- Useful for testing warehouse functionality

**When to use**:
- Testing warehouse product management
- Creating test environment with warehouse-only products
- Development and testing scenarios

### db_delete_all_records.py

**Purpose**: Deletes all database records (except superusers)

**Usage**:
```powershell
python db_delete_all_records.py
```

**What it does**:
- Deletes all Sales records
- Deletes all OrderItems
- Deletes all Orders
- Deletes all Products
- Deletes all Categories
- Deletes all non-superuser Users
- Preserves superuser accounts for admin access

**When to use**:
- Starting completely fresh
- Clearing test data
- Before importing new data

**Warning**: This is destructive! All data will be lost (except superusers).

### extract_product_images.py

**Purpose**: Lists all product images from media folder

**Usage**:
```powershell
python extract_product_images.py
```

**What it does**:
- Scans `media/products/` directory
- Lists all image files (.jpg, .png, .gif)
- Saves list to `product_images_list.txt`

**When to use**:
- Auditing product images
- Checking which images exist
- Before bulk operations on images

### compare_product_images.py

**Purpose**: Compares actual images with stored list

**Usage**:
```powershell
python compare_product_images.py
```

**What it does**:
- Reads `product_images_list.txt`
- Compares with actual files in `media/products/`
- Identifies missing images
- Identifies extra images not in list

**When to use**:
- Finding missing product images
- Identifying orphaned image files
- Verifying image integrity

### create_admin.py

**Purpose**: Creates a superuser account programmatically

**Usage**:
```powershell
python create_admin.py
```

**What it does**:
- Creates superuser with predefined credentials
- Username: admin
- Password: admin123

**When to use**:
- Quick admin account creation
- Automated setup scripts

### set_existing_products_online.py

**Purpose**: Sets all products to online status

**Usage**:
```powershell
python set_existing_products_online.py
```

**What it does**:
- Updates all products to `is_online=True`
- Makes all warehouse products visible to customers

**When to use**:
- Bulk publishing warehouse products
- Making entire catalog visible

### Workflow Examples

**Complete Fresh Setup**:
```powershell
# 1. Delete old database
Remove-Item db.sqlite3

# 2. Create database structure
python manage.py migrate

# 3. Create admin account
python create_admin.py

# 4. Populate with all products
python restore_database.py
```

**Backup Current Data**:
```powershell
# Export current products
python export_products.py

# Copy exported file for safekeeping
Copy-Item exported_products.py exported_products_backup.py
```

**Reset to Original State**:
```powershell
# Delete all data
python db_delete_all_records.py

# Restore original products
python restore_database.py
```

---

